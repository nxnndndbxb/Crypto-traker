<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDNC Coin Airdrop | The Future of Crypto</title>
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* --- [V4] Supernova Theme --- */
        :root {
            --primary-accent: #00f2a9; /* Vibrant Teal */
            --secondary-accent: #ff4d9d; /* Electric Pink */
            --tertiary-accent: #ffa800; /* Warm Gold */
            --success-color: #00f2a9;
            --danger-color: #ff4d9d;
            --warning-color: #ffa800; /* For pending status */
            --background-dark: #0A0B14; /* Even Deeper Space */
            --surface-bg: rgba(22, 24, 45, 0.65);
            --surface-border: rgba(255, 255, 255, 0.08);
            --surface-highlight: rgba(255, 255, 255, 0.03);
            --text-primary: #F0F2F5;
            --text-secondary: #8A94A6;
            --font-family: 'Poppins', sans-serif;
            --border-radius: 24px;
            --transition-speed: 0.4s;
        }

        /* --- General & Body Styling --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }

        body {
            font-family: var(--font-family);
            background-color: var(--background-dark);
            color: var(--text-primary);
            padding-bottom: 120px;
            overflow-x: hidden;
            position: relative;
        }

        /* --- Animated Backgrounds --- */
        #background-effects {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
            overflow: hidden;
        }
        .cosmic-overlay {
            position: absolute; width: 100%; height: 100%;
            background:
                radial-gradient(ellipse 50% 50% at 20% 20%, hsla(160, 100%, 50%, 0.1), transparent 60%),
                radial-gradient(ellipse 40% 50% at 80% 70%, hsla(320, 100%, 65%, 0.1), transparent 60%);
            animation: background-pan 25s infinite alternate ease-in-out;
        }
        .radar-sweep {
            position: absolute; top: 50%; left: 50%;
            width: 200vw; height: 200vw;
            background: conic-gradient(from 0deg, transparent 0%, transparent 70%, hsla(160, 100%, 50%, 0.15) 95%, transparent 100%);
            animation: radar-spin 15s linear infinite;
            transform-origin: center center;
            transform: translate(-50%, -50%);
        }

        @keyframes background-pan {
            from { transform: translate(-10%, -10%) scale(1.2); }
            to { transform: translate(10%, 10%) scale(1.2); }
        }
        @keyframes radar-spin { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }

        #particles-js {
            position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: -1;
        }

        /* --- Preloader --- */
        #preloader {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: var(--background-dark); display: flex; justify-content: center; align-items: center;
            z-index: 9999; transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        #preloader.hidden { opacity: 0; visibility: hidden; }
        .spinner {
            width: 60px; height: 60px; border-radius: 50%;
            border: 4px solid var(--surface-border); border-top-color: var(--primary-accent);
            animation: spin-loader 1s linear infinite;
        }
        @keyframes spin-loader { to { transform: rotate(360deg); } }

        /* --- Main App Containers & Page Transitions --- */
        .page {
            display: none; padding: 20px;
            animation: pageFadeIn 0.8s cubic-bezier(0.165, 0.84, 0.44, 1);
            min-height: calc(100vh - 120px);
        }
        .page.active { display: block; }
        @keyframes pageFadeIn {
            from { opacity: 0; transform: translateY(30px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* --- Content Panel Component --- */
        .content-panel {
            background: var(--surface-bg); border: 1px solid var(--surface-border);
            border-radius: var(--border-radius); padding: 30px;
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            box-shadow: 0 16px 40px rgba(0, 0, 0, 0.3), inset 0 1px 0 0 var(--surface-highlight);
            margin-bottom: 25px; position: relative; overflow: hidden;
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
        }
        .content-panel::before { /* Shine on Hover */
            content: ''; position: absolute; top: 0; left: -100%;
            width: 75%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.07), transparent);
            transition: left 0.6s ease;
        }
        .content-panel:hover::before { left: 125%; }
        .content-panel h3 {
            font-weight: 700; font-size: 1.5em;
            background: linear-gradient(90deg, var(--primary-accent), var(--secondary-accent));
            -webkit-background-clip: text; background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--surface-border);
        }

        /* --- Auth Pages --- */
        #auth-container { display: none; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        #auth-container.active { display: flex; }
        .auth-form { width: 100%; max-width: 420px; }
        .auth-form h2 {
            text-align: center; font-weight: 800; font-size: 3em; margin-bottom: 30px;
            background: linear-gradient(90deg, var(--primary-accent), var(--secondary-accent));
            -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px hsla(160, 100%, 50%, 0.3);
        }
        .input-group { position: relative; margin-bottom: 25px; }
        .input-group i.fa-solid {
            position: absolute; left: 20px; top: 50%;
            transform: translateY(-50%); color: var(--text-secondary);
            transition: color var(--transition-speed) ease;
        }
        .input-group .toggle-password { left: auto; right: 20px; cursor: pointer; }
        .input-group input {
            width: 100%; padding: 18px 20px 18px 55px;
            border: 1px solid var(--surface-border); border-radius: 16px;
            background-color: rgba(0,0,0,0.3); color: var(--text-primary);
            font-family: var(--font-family); font-size: 1em;
            transition: all var(--transition-speed) ease;
        }
        .input-group input:focus {
            outline: none; border-color: var(--primary-accent);
            box-shadow: 0 0 20px hsla(160, 100%, 50%, 0.5);
        }
        .input-group input:focus ~ i.fa-solid { color: var(--primary-accent); }
        .btn {
            display: flex; justify-content: center; align-items: center;
            width: 100%; padding: 18px; border: none; border-radius: 16px;
            color: var(--background-dark); font-size: 1.1em; font-weight: 700;
            cursor: pointer; transition: all var(--transition-speed) cubic-bezier(0.165, 0.84, 0.44, 1);
            position: relative; overflow: hidden;
            background: linear-gradient(90deg, var(--primary-accent), var(--tertiary-accent));
            box-shadow: 0 8px 30px -8px hsla(160, 100%, 50%, 0.6);
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .btn:hover:not(:disabled) { transform: translateY(-5px) scale(1.02); box-shadow: 0 12px 35px -8px hsla(160, 100%, 50%, 0.8); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: translateY(0); box-shadow: none; }
        .btn .btn-text { transition: opacity 0.2s ease; }
        .btn .spinner-sm {
            position: absolute; width: 24px; height: 24px;
            border: 3px solid rgba(13, 14, 27, 0.3); border-top-color: var(--background-dark); border-radius: 50%;
            animation: spin-loader 0.8s linear infinite;
            opacity: 0; transition: opacity 0.2s ease;
        }
        .btn.loading .btn-text { opacity: 0; }
        .btn.loading .spinner-sm { opacity: 1; }
        .auth-switch { text-align: center; margin-top: 25px; color: var(--text-secondary); }
        .auth-switch a { color: var(--primary-accent); text-decoration: none; font-weight: 600; }
        #app-container { display: none; }
        #app-container.active { display: block; }

        /* --- Bottom Navigation Bar --- */
        .bottom-nav {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: calc(100% - 40px); max-width: 500px; height: 80px;
            background: var(--surface-bg); border: 1px solid var(--surface-border);
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            display: flex; justify-content: space-around; align-items: center;
            border-radius: var(--border-radius); box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
            z-index: 1000;
        }
        .nav-btn {
            background: none; border: none; color: var(--text-secondary);
            display: flex; flex-direction: column; align-items: center;
            font-size: 0.75em; font-weight: 500; cursor: pointer;
            transition: all var(--transition-speed) ease;
            position: relative; padding: 10px; width: 65px;
        }
        .nav-btn i { font-size: 2em; margin-bottom: 6px; }
        .nav-btn.active { color: var(--text-primary); transform: translateY(-5px); }
        .nav-btn.active i { color: var(--primary-accent); text-shadow: 0 0 20px var(--primary-accent); }
        .nav-btn::before {
            content: ''; position: absolute; bottom: -5px; width: 8px; height: 8px;
            background-color: var(--primary-accent); border-radius: 50%; transform: scale(0);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .nav-btn.active::before { transform: scale(1); }

        /* --- Home Page --- */
        .header-welcome { text-align: center; margin-bottom: 20px; }
        .header-welcome h2 { font-size: 2.2em; font-weight: 700; line-height: 1.2; }
        .header-welcome p { color: var(--text-secondary); font-weight: 300; font-size: 1.1em; }

        /* --- EDIT: AI Bot Ticker (small) --- */
        .ai-bot-ticker {
            display: flex; align-items: center; justify-content: center; gap: 15px;
            background: rgba(0,0,0,0.25); border-radius: 12px;
            padding: 10px 15px; margin-bottom: 40px; border-top: 1px solid var(--surface-border);
            font-size: 0.9em;
        }
        .ai-bot-ticker .icon { color: var(--primary-accent); animation: bot-pulse-sm 2s infinite ease-in-out; }
        @keyframes bot-pulse-sm { 50% { transform: scale(1.1); } }
        .ai-bot-ticker .status { color: var(--text-secondary); }
        .ai-bot-ticker .countdown { font-family: 'Courier New', monospace; font-weight: bold; color: var(--tertiary-accent); }

        /* --- EDIT: Large Coin --- */
        .coin-wrapper { 
            perspective: 3000px;
            margin-bottom: 40px;
        }
        .coin-container {
            margin: 0 auto; width: 200px; height: 200px; position: relative;
            transform-style: preserve-3d;
            transition: transform 0.2s ease-out; /* For mouse interaction */
        }
        .coin-aura {
            width: 100%; height: 100%; position: absolute;
            background: radial-gradient(circle, var(--primary-accent), transparent 65%);
            filter: blur(50px); animation: aura-pulse 5s infinite ease-in-out;
        }
        @keyframes aura-pulse { 50% { transform: scale(1.3); opacity: 0.6; } }
        .coin {
            width: 100%; height: 100%; position: relative;
            transform-style: preserve-3d; animation: spin 20s infinite linear;
        }
        .coin-face, .coin-edge { position: absolute; width: 100%; height: 100%; border-radius: 50%; }
        .coin-face {
            background: linear-gradient(45deg, #1e2035, #3c406d);
            display: flex; justify-content: center; align-items: center;
            font-size: 5.5em; font-weight: 800; color: transparent;
            background-clip: text; -webkit-background-clip: text;
            text-shadow: rgba(255,255,255,0.1) -1px -1px 1px, rgba(0,0,0,0.5) 1px 1px 1px;
            box-shadow: inset 0 0 40px rgba(0,0,0,0.5);
            -webkit-backface-visibility: hidden; backface-visibility: hidden;
        }
        .coin-face::before { /* Metallic sheen */
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 50%);
        }
        .front { transform: translateZ(15px); } /* EDIT: increased thickness */
        .back { transform: rotateY(180deg) translateZ(15px); } /* EDIT: increased thickness */
        .coin-edge { background: linear-gradient(to right, #2a2d46, #4c507c, #2a2d46); transform: translateZ(0); }
        @keyframes spin { from { transform: rotateY(0deg); } to { transform: rotateY(360deg); } }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .stat-card {
            background: rgba(0,0,0,0.25); border-radius: 20px; padding: 25px;
            text-align: center; border: 1px solid transparent; transition: all var(--transition-speed) ease;
        }
        .stat-card:hover { border-color: var(--surface-border); transform: scale(1.05) translateY(-5px); }
        .stat-card .label { font-size: 0.9em; color: var(--text-secondary); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-card .value { font-size: 1.6em; font-weight: 600; }
        .price-up { color: var(--success-color); }
        .price-down { color: var(--danger-color); }
        .value, .amount { transition: color 0.5s ease; }
        .info-text { font-size: 0.9em; color: var(--text-secondary); text-align: center; margin-top: 15px; line-height: 1.6; }

        /* --- Trade, Wallet & Profile Pages --- */
        .balance-display { text-align: center; margin-bottom: 25px; }
        .balance-display .amount {
            font-size: 4em; font-weight: 700; line-height: 1.1;
            background: linear-gradient(90deg, var(--primary-accent), var(--tertiary-accent));
            -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px hsla(160, 100%, 50%, 0.3);
        }
        .balance-display .currency { color: var(--text-secondary); font-weight: 400; font-size: 1.1em; }
        .balance-on-hold { text-align: center; color: var(--warning-color); font-size: 0.9em; margin-top: -15px; margin-bottom: 25px; }
        
        .trade-form input, .modal-content select {
             width: 100%; padding: 18px; border: 1px solid var(--surface-border);
             border-radius: 16px; background-color: rgba(0,0,0,0.3);
             color: var(--text-primary); font-size: 1em; margin-bottom: 20px;
        }
        .trade-actions, .wallet-actions { display: flex; gap: 20px; margin-top: 20px; }
        .trade-actions .btn, .wallet-actions .btn { flex: 1; }
        .btn-buy { background: linear-gradient(90deg, #00b09b, var(--primary-accent)); box-shadow: 0 0 25px hsla(167, 100%, 43%, 0.5); }
        .btn-sell { background: linear-gradient(90deg, var(--secondary-accent), #ff6b81); box-shadow: 0 0 25px hsla(355, 100%, 63%, 0.5); }

        /* Transaction History */
        #transaction-history-list { list-style-type: none; max-height: 400px; overflow-y: auto; padding-right: 10px; }
        .transaction-item {
            display: flex; align-items: center; padding: 15px; margin-bottom: 10px;
            background-color: rgba(0,0,0,0.2); border-radius: 12px;
            border-left: 4px solid var(--text-secondary);
        }
        .transaction-item.buy, .transaction-item.deposit { border-left-color: var(--success-color); }
        .transaction-item.sell, .transaction-item.withdrawal { border-left-color: var(--danger-color); }
        .transaction-item.pending { border-left-color: var(--warning-color); opacity: 0.8; }
        .transaction-item .icon { font-size: 1.5em; width: 40px; text-align: center; margin-right: 15px; }
        .transaction-item.buy .icon, .transaction-item.deposit .icon { color: var(--success-color); }
        .transaction-item.sell .icon, .transaction-item.withdrawal .icon { color: var(--danger-color); }
        .transaction-item.pending .icon { color: var(--warning-color); }
        .transaction-item .details { flex-grow: 1; }
        .transaction-item .type { font-weight: 600; text-transform: capitalize; }
        .transaction-item .date { font-size: 0.8em; color: var(--text-secondary); }
        .transaction-item .amount { font-size: 1.1em; font-weight: 600; text-align: right; }

        /* Profile Page */
        .profile-info { list-style: none; margin-bottom: 30px; }
        .profile-info li {
            display: flex; justify-content: space-between; padding: 18px 0;
            border-bottom: 1px solid var(--surface-border); font-size: 1.1em;
        }
        .profile-info li span:first-child { color: var(--text-secondary); }
        .profile-info li span:last-child { font-weight: 600; }

        /* --- Invite Page --- */
        .invite-box { text-align: center; }
        .invite-box .icon { font-size: 4em; margin: 20px 0; color: var(--primary-accent); text-shadow: 0 0 25px var(--primary-accent); }
        .invite-box p { color: var(--text-secondary); line-height: 1.8; margin-bottom: 25px; font-size: 1.05em;}
        .invite-code {
            background-color: rgba(0,0,0,0.35); padding: 25px; border-radius: 16px; border: 1px dashed var(--surface-border);
            font-family: 'Courier New', Courier, monospace; font-size: 1.1em; margin: 25px 0;
            word-wrap: break-word; text-align: center; color: var(--primary-accent); font-weight: bold;
        }

        /* --- Modal (for Recharge/Withdraw) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(13, 14, 27, 0.8); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            z-index: 2000; display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity var(--transition-speed) ease;
        }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        .modal-content {
            width: calc(100% - 40px); max-width: 450px; transform: scale(0.95) translateY(20px);
            transition: transform var(--transition-speed) cubic-bezier(0.165, 0.84, 0.44, 1);
        }
        .modal-overlay.active .modal-content { transform: scale(1) translateY(0); }
        .option-group {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 25px;
            background-color: rgba(0,0,0,0.25); padding: 6px; border-radius: 18px;
        }
        .option-btn {
            padding: 14px; border: none; background-color: transparent; color: var(--text-secondary);
            border-radius: 14px; cursor: pointer; transition: all 0.3s ease; font-weight: 600;
        }
        .option-btn.active {
            background: linear-gradient(90deg, var(--primary-accent), var(--secondary-accent));
            color: var(--background-dark); box-shadow: 0 0 20px hsla(320, 100%, 65%, 0.5);
        }
        .address-box {
            background-color: rgba(0,0,0,0.35); padding: 20px; border-radius: 16px; margin-bottom: 20px;
            word-wrap: break-word; display: flex; justify-content: space-between; align-items: center;
            border: 1px solid var(--surface-border);
        }
        .address-box .address { flex: 1; margin-right: 15px; font-family: monospace; }
        .copy-btn {
            background: none; border: none; color: var(--primary-accent); cursor: pointer; font-size: 1.5em;
            transition: color 0.3s ease;
        }
        .copy-btn:hover { color: var(--text-primary); }
        .btn-subtle {
            background: none; border: 1px solid var(--surface-border);
            color: var(--text-secondary); box-shadow: none; text-transform: none; letter-spacing: 0;
        }
        .btn-subtle:hover { background: var(--surface-bg); color: var(--text-primary); }
        .modal-close-btn {
            position: absolute; top: 15px; right: 15px;
            background: rgba(255,255,255,0.1); border: none; color: var(--text-primary);
            width: 36px; height: 36px; border-radius: 50%; font-size: 1.2em;
            cursor: pointer; transition: background-color 0.3s ease; z-index: 10;
        }
        .modal-close-btn:hover { background-color: rgba(255,255,255,0.2); }

        /* --- Toast Notification System --- */
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
        .toast {
            background: var(--surface-bg); border-left: 5px solid var(--primary-accent);
            border-radius: 12px; padding: 18px 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4); color: var(--text-primary); margin-bottom: 10px;
            opacity: 0; transform: translateX(100%);
            animation: toastIn 0.5s cubic-bezier(0.165, 0.84, 0.44, 1) forwards;
            min-width: 300px; backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
        }
        @keyframes toastIn { to { opacity: 1; transform: translateX(0); } }
        .toast.success { border-left-color: var(--success-color); }
        .toast.danger { border-left-color: var(--danger-color); }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <div id="background-effects">
        <div class="cosmic-overlay"></div>
        <div class="radar-sweep"></div>
    </div>
    <div id="toast-container"></div>

    <!-- Preloader -->
    <div id="preloader"><div class="spinner"></div></div>

    <!-- Authentication Container -->
    <div id="auth-container">
        <div id="login-page-container" class="auth-form">
            <div class="content-panel">
                <h2>Welcome Back</h2>
                <form id="login-form">
                    <div class="input-group">
                        <input type="email" id="login-email" required placeholder="Email" autocomplete="email">
                        <i class="fa-solid fa-envelope"></i>
                    </div>
                    <div class="input-group">
                        <input type="password" id="login-password" required placeholder="Password" autocomplete="current-password">
                        <i class="fa-solid fa-lock"></i>
                        <i class="fa-solid fa-eye toggle-password"></i>
                    </div>
                    <button type="submit" class="btn"><span class="btn-text">Login Securely</span><div class="spinner-sm"></div></button>
                </form>
                <p class="auth-switch">No account? <a href="#" id="show-register-link">Sign Up</a></p>
            </div>
        </div>
        <div id="register-page-container" class="auth-form" style="display: none;">
            <div class="content-panel">
                <h2>Create Account</h2>
                <form id="register-form">
                    <div class="input-group">
                        <input type="email" id="register-email" required placeholder="Email" autocomplete="email">
                        <i class="fa-solid fa-envelope"></i>
                    </div>
                    <div class="input-group">
                        <input type="password" id="register-password" required placeholder="Password" autocomplete="new-password">
                        <i class="fa-solid fa-lock"></i>
                        <i class="fa-solid fa-eye toggle-password"></i>
                    </div>
                    <div class="input-group">
                        <input type="text" id="register-ref-code" placeholder="Invitation Code (Optional)" autocomplete="off">
                        <i class="fa-solid fa-gift"></i>
                    </div>
                    <button type="submit" class="btn"><span class="btn-text">Create My Account</span><div class="spinner-sm"></div></button>
                </form>
                <p class="auth-switch">Have an account? <a href="#" id="show-login-link">Login</a></p>
            </div>
        </div>
    </div>

    <!-- Main Application Container -->
    <div id="app-container">
        <!-- Home Page -->
        <main id="home-page" class="page">
            <header class="header-welcome">
                <h2 id="welcome-user">Dashboard</h2>
                <p>Your cosmic journey starts here.</p>
            </header>

            <!-- EDIT: New AI Bot Ticker -->
            <div class="ai-bot-ticker">
                <div class="icon"><i class="fas fa-robot"></i></div>
                <div class="status" id="ai-bot-status">Initializing AI...</div>
                <div class="countdown" id="ai-bot-countdown">--:--:--</div>
            </div>

            <!-- EDIT: Enlarged Coin -->
            <div class="coin-wrapper">
                <div class="coin-container" id="interactive-coin-container">
                    <div class="coin-aura"></div>
                    <div class="coin">
                        <div class="coin-edge"></div>
                        <div class="coin-face front">C</div>
                        <div class="coin-face back">$</div>
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="label">CDNC Price</div>
                    <div class="value" id="home-coin-price">$....</div>
                </div>
                <div class="stat-card">
                    <div class="label">Your CDNC</div>
                    <div class="value" id="home-cdnc-balance">0.00</div>
                </div>
                <div class="stat-card">
                    <div class="label">Your Wallet</div>
                    <div class="value" id="home-usd-balance">$0.00</div>
                </div>
                 <div class="stat-card">
                    <div class="label">Your Holdings</div>
                    <div class="value" id="home-holdings-value">$0.00</div>
                </div>
            </div>
        </main>

        <!-- Trade Page -->
        <section id="trade-page" class="page">
            <div class="content-panel">
                <h3>Your CDNC Holdings</h3>
                <div class="balance-display">
                    <span class="amount" id="trade-cdnc-balance">0.00</span>
                    <span class="currency">CDNC</span>
                </div>
            </div>
            <div class="content-panel">
                <h3>Trade CDNC</h3>
                <p class="info-text" style="margin-bottom: 20px;">Price: <b id="trade-coin-price">$....</b> | Available Wallet: <b id="trade-usd-balance">$0.00</b></p>
                <div class="trade-form">
                    <input type="number" id="trade-amount" placeholder="Enter amount of CDNC" min="0">
                </div>
                <div class="trade-actions">
                    <button class="btn btn-buy" id="buy-btn"><i class="fas fa-arrow-up"></i>  <span class="btn-text">Buy</span><div class="spinner-sm"></div></button>
                    <button class="btn btn-sell" id="sell-btn"><i class="fas fa-arrow-down"></i>  <span class="btn-text">Sell</span><div class="spinner-sm"></div></button>
                </div>
            </div>
        </section>

        <!-- Invite Page -->
        <section id="invite-page" class="page">
             <div class="content-panel invite-box">
                <h3>Invite & Earn 10%</h3>
                <div class="icon"><i class="fas fa-users-rays"></i></div>
                <p>Share your unique link. When your friend makes their first deposit and it's approved, you'll receive a 10% bonus of their deposited amount directly into your wallet!</p>
                <p class="info-text">Your Invitation Link:</p>
                <div class="invite-code" id="invite-link-display">Generating...</div>
                <button class="btn" id="copy-invite-link-btn"><span class="btn-text"><i class="fas fa-copy"></i>  Copy My Link</span></button>
            </div>
        </section>

        <!-- Wallet Page -->
        <section id="wallet-page" class="page">
             <div class="content-panel">
                <h3>My Wallet</h3>
                <div class="balance-display">
                    <span class="amount" id="wallet-usd-balance">$0.00</span>
                    <span class="currency">Available USD Balance</span>
                </div>
                <!-- EDIT: Added display for funds on hold -->
                <div class="balance-on-hold" id="wallet-on-hold-balance">On Hold for Withdrawal: $0.00</div>
                <div class="wallet-actions">
                    <button class="btn btn-buy" id="recharge-btn-modal"><i class="fas fa-plus-circle"></i>  Recharge</button>
                    <button class="btn btn-sell" id="withdraw-btn-modal"><i class="fas fa-paper-plane"></i>  Withdraw</button>
                </div>
            </div>
            <div class="content-panel">
                <h3>Transaction History</h3>
                <ul id="transaction-history-list">
                    <!-- JS will populate this -->
                    <p class="info-text" id="no-transactions-msg">No transactions yet.</p>
                </ul>
            </div>
        </section>

        <!-- Profile Page -->
        <section id="profile-page" class="page">
            <div class="content-panel">
                <h3>My Profile</h3>
                <ul class="profile-info">
                    <li><span>Email</span> <span id="profile-email">...</span></li>
                    <li><span>User ID</span> <span id="profile-uid" style="font-size: 0.8em; font-family: monospace;">...</span></li>
                    <li><span>Referral Code</span> <span id="profile-ref-code">...</span></li>
                </ul>
                <button id="logout-btn" class="btn btn-sell"><span class="btn-text">Logout</span><div class="spinner-sm"></div></button>
            </div>
        </section>

        <!-- Bottom Navigation Bar -->
        <nav class="bottom-nav">
            <button class="nav-btn active" data-page="home-page"><i class="fas fa-home"></i><span>Home</span></button>
            <button class="nav-btn" data-page="trade-page"><i class="fas fa-rocket"></i><span>Trade</span></button>
            <button class="nav-btn" data-page="wallet-page"><i class="fas fa-wallet"></i><span>Wallet</span></button>
            <button class="nav-btn" data-page="invite-page"><i class="fas fa-user-plus"></i><span>Invite</span></button>
            <button class="nav-btn" data-page="profile-page"><i class="fas fa-user-astronaut"></i><span>Profile</span></button>
        </nav>
    </div>

    <!-- Recharge Modal -->
    <div id="recharge-modal" class="modal-overlay">
        <div class="modal-content content-panel">
            <button class="modal-close-btn" data-modal-id="recharge-modal">×</button>
            <h3>Recharge USD</h3>
            <p class="info-text">Select Network to Deposit USDT. Your deposit will be reviewed by an administrator and credited upon approval.</p>
            <div class="option-group">
                <button class="option-btn active" data-network="trc20">TRC20</button>
                <button class="option-btn" data-network="bep20">BEP20</button>
            </div>
            <div id="recharge-trc20" class="recharge-details">
                <p class="info-text">Send USDT (TRC20) to this address:</p>
                <div class="address-box">
                    <span class="address" id="trc20-address">TKEmWeig1jtWLgPZp4pX4PHAsPsrFNdqf2</span>
                    <button class="copy-btn" data-copy-target="trc20-address"><i class="far fa-copy"></i></button>
                </div>
            </div>
            <div id="recharge-bep20" class="recharge-details" style="display: none;">
                <p class="info-text">Send USDT (BEP20) to this address:</p>
                <div class="address-box">
                    <span class="address" id="bep20-address">0xeb0ee64208106984101b1f127cf221358771dbfa</span>
                    <button class="copy-btn" data-copy-target="bep20-address"><i class="far fa-copy"></i></button>
                </div>
            </div>
            <p class="info-text" style="margin-top: 25px;">After sending, paste the amount and transaction ID below.</p>
            <form id="recharge-form">
                <div class="input-group" style="margin-top: 15px;"><input type="number" id="recharge-amount" placeholder="Amount Sent (USDT)" required min="0.01" step="0.01"></div>
                <div class="input-group"><input type="text" id="transaction-id" placeholder="Transaction ID (TxID)" required></div>
                <button id="submit-recharge-btn" type="submit" class="btn"><span class="btn-text">Submit for Review</span><div class="spinner-sm"></div></button>
            </form>
        </div>
    </div>

    <!-- Withdrawal Modal -->
    <div id="withdrawal-modal" class="modal-overlay">
        <div class="modal-content content-panel">
            <button class="modal-close-btn" data-modal-id="withdrawal-modal">×</button>
            <h3>Withdraw USD</h3>
            <form id="withdrawal-form">
                <div class="input-group"><input type="number" id="withdraw-amount" placeholder="Amount (USD) - Min $5.00" required min="5" step="0.01"></div>
                <div class="input-group">
                    <select id="withdraw-network" required>
                        <option value="trc20">USDT (TRC20)</option>
                        <option value="bep20">USDT (BEP20)</option>
                    </select>
                </div>
                <div class="input-group"><input type="text" id="withdraw-address" placeholder="Your Receiving USDT Address" required></div>
                <button id="submit-withdrawal-btn" type="submit" class="btn"><span class="btn-text">Request Withdrawal</span><div class="spinner-sm"></div></button>
            </form>
            <p class="info-text">A 5% network fee applies. Funds will be held for review and processed by an admin within 24 hours.</p>
        </div>
    </div>

    <!-- Firebase & Particle.js -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        const App = {
            // --- [1] CONFIG & INITIALIZATION ---
            config: {
                firebase: {
                    // WARNING: Replace with your actual Firebase config.
                    apiKey: "AIzaSyCL-Sx0C3O3yDv1fxsIbq8Fb9cw04oEfNM",
                    authDomain: "airdrop-f68c4.firebaseapp.com",
                    databaseURL: "https://airdrop-f68c4-default-rtdb.asia-southeast1.firebasedatabase.app/",
                    projectId: "airdrop-f68c4",
                    storageBucket: "airdrop-f68c4.appspot.com",
                    messagingSenderId: "931221762140",
                    appId: "1:931221762140:web:48d085601d9dfd7b425556"
                },
                WITHDRAWAL_FEE_PERCENT: 0.05,
                MIN_WITHDRAWAL_USD: 5,
                REFERRAL_BONUS_PERCENT: 0.10,
                SIGNUP_BONUS_CDNC: 100,
                PRICE_UPDATE_INTERVAL_HOURS: 24,
                PRICE_INCREASE_MIN_PERCENT: 0.05, // 5%
                PRICE_INCREASE_MAX_PERCENT: 0.10, // 10%
                PRELOADER_TIMEOUT: 8000
            },

            // --- [2] STATE MANAGEMENT ---
            state: {
                currentUser: null,
                userData: null,
                coinPrice: 1.0, // Default, will be overwritten by Firebase
                marketDataRef: null,
                countdownInterval: null,
                userRef: null,
                txRef: null,
                preloaderTimeoutId: null,
                ui: {},
            },

            async init() {
                this.cacheDOMElements();
                this.initFirebase();
                this.initParticles();
                this.bindEventListeners();
                this.handleAuth();

                this.state.preloaderTimeoutId = setTimeout(() => {
                    this.hidePreloader();
                    this.showToast('Could not connect. Please try again later.', 'danger');
                }, this.config.PRELOADER_TIMEOUT);
            },

            initFirebase() {
                try {
                    firebase.initializeApp(this.config.firebase);
                    this.auth = firebase.auth();
                    this.db = firebase.database();
                } catch (error) {
                    console.error("Firebase initialization failed:", error);
                    this.showToast('Application failed to load.', 'danger');
                }
            },

            initParticles() {
                if (typeof particlesJS !== 'undefined') {
                    particlesJS('particles-js', { "particles": { "number": { "value": 60, "density": { "enable": true, "value_area": 800 } }, "color": { "value": "#ffffff" }, "shape": { "type": "circle" }, "opacity": { "value": 0.5, "random": true, "anim": { "enable": true, "speed": 1, "opacity_min": 0.1 } }, "size": { "value": 3, "random": true }, "line_linked": { "enable": true, "distance": 150, "color": "#8A94A6", "opacity": 0.2, "width": 1 }, "move": { "enable": true, "speed": 1, "direction": "none", "random": true, "out_mode": "out" } }, "interactivity": { "events": { "onhover": { "enable": true, "mode": "grab" }, "onclick": { "enable": true, "mode": "push" } }, "modes": { "grab": { "distance": 140, "line_linked": { "opacity": 0.5 } }, "push": { "particles_nb": 4 } } }, "retina_detect": true });
                }
            },

            // --- [3] UI / DOM MANIPULATION ---
            cacheDOMElements() {
                this.state.ui = {
                    preloader: document.getElementById('preloader'),
                    authContainer: document.getElementById('auth-container'),
                    appContainer: document.getElementById('app-container'),
                    loginPage: document.getElementById('login-page-container'),
                    registerPage: document.getElementById('register-page-container'),
                    loginForm: document.getElementById('login-form'),
                    registerForm: document.getElementById('register-form'),
                    rechargeForm: document.getElementById('recharge-form'),
                    withdrawalForm: document.getElementById('withdrawal-form'),
                    welcomeUser: document.getElementById('welcome-user'),
                    homeCoinPrice: document.getElementById('home-coin-price'),
                    homeUsdBalance: document.getElementById('home-usd-balance'),
                    homeCdncBalance: document.getElementById('home-cdnc-balance'),
                    homeHoldingsValue: document.getElementById('home-holdings-value'),
                    tradeCoinPrice: document.getElementById('trade-coin-price'),
                    tradeUsdBalance: document.getElementById('trade-usd-balance'),
                    tradeCdncBalance: document.getElementById('trade-cdnc-balance'),
                    walletUsdBalance: document.getElementById('wallet-usd-balance'),
                    walletOnHoldBalance: document.getElementById('wallet-on-hold-balance'), // EDIT: new UI element
                    inviteLinkDisplay: document.getElementById('invite-link-display'),
                    profileEmail: document.getElementById('profile-email'),
                    profileUid: document.getElementById('profile-uid'),
                    profileRefCode: document.getElementById('profile-ref-code'),
                    transactionList: document.getElementById('transaction-history-list'),
                    noTransactionsMsg: document.getElementById('no-transactions-msg'),
                    aiBotStatus: document.getElementById('ai-bot-status'),
                    aiBotCountdown: document.getElementById('ai-bot-countdown'),
                };
            },

            showPage(pageId) {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById(pageId)?.classList.add('active');
                document.querySelectorAll('.nav-btn').forEach(b => {
                    b.classList.toggle('active', b.dataset.page === pageId);
                });
                window.scrollTo(0, 0);
            },

            showModal(modalId) { document.getElementById(modalId)?.classList.add('active'); },
            hideModal(modalId) { document.getElementById(modalId)?.classList.remove('active'); },
            hideAllModals() { document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active')); },

            showToast(message, type = 'success') {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                container.appendChild(toast);
                setTimeout(() => toast.remove(), 4000);
            },

            hidePreloader() {
                if (this.state.preloaderTimeoutId) clearTimeout(this.state.preloaderTimeoutId);
                this.state.ui.preloader.classList.add('hidden');
            },

            setButtonLoading(btn, isLoading) {
                if (btn) {
                    btn.classList.toggle('loading', isLoading);
                    btn.disabled = isLoading;
                }
            },

            updateStaticPriceUI() {
                const formattedPrice = `$${this.state.coinPrice.toFixed(4)}`;
                const priceElements = [this.state.ui.homeCoinPrice, this.state.ui.tradeCoinPrice];
                priceElements.forEach(el => el ? el.innerText = formattedPrice : null);
                if(this.state.userData) {
                    const holdingsValue = (this.state.userData.cdnc_balance || 0) * this.state.coinPrice;
                    this.state.ui.homeHoldingsValue.innerText = `$${holdingsValue.toFixed(2)}`;
                }
            },

            updateUI(oldData = {}) {
                if (!this.state.userData) return;
                const { usd_balance = 0, cdnc_balance = 0, balance_on_hold = 0, email, uid, referralCode } = this.state.userData;
                const oldUsd = oldData.usd_balance || 0;
                const oldCdnc = oldData.cdnc_balance || 0;
                const holdingsValue = cdnc_balance * this.state.coinPrice;

                const formatCurrency = (num) => `$${Number(num || 0).toFixed(2)}`;
                const formatToken = (num) => Number(num || 0).toFixed(2);
                
                // Animate values if needed, for now using direct assignment
                this.state.ui.welcomeUser.textContent = `Welcome, ${email.split('@')[0]}`;
                this.state.ui.homeUsdBalance.textContent = formatCurrency(usd_balance);
                this.state.ui.homeCdncBalance.textContent = formatToken(cdnc_balance);
                this.state.ui.tradeCdncBalance.textContent = formatToken(cdnc_balance);
                this.state.ui.walletUsdBalance.textContent = formatCurrency(usd_balance);
                this.state.ui.walletOnHoldBalance.textContent = `On Hold for Withdrawal: ${formatCurrency(balance_on_hold)}`;

                this.state.ui.homeHoldingsValue.innerText = formatCurrency(holdingsValue);
                this.state.ui.tradeUsdBalance.innerText = formatCurrency(usd_balance);
                this.state.ui.inviteLinkDisplay.innerText = `${window.location.origin}${window.location.pathname}?ref=${referralCode}`;
                this.state.ui.profileEmail.textContent = email;
                this.state.ui.profileUid.textContent = uid;
                this.state.ui.profileRefCode.textContent = referralCode;
            },

            updateTransactionHistory(transactions) {
                this.state.ui.transactionList.innerHTML = '';
                if (!transactions || Object.keys(transactions).length === 0) {
                    this.state.ui.noTransactionsMsg.style.display = 'block';
                    return;
                }
                this.state.ui.noTransactionsMsg.style.display = 'none';
                const sortedTxs = Object.values(transactions).sort((a, b) => b.timestamp - a.timestamp);
                sortedTxs.forEach(tx => {
                    const item = document.createElement('li');
                    const isPending = tx.details?.status === 'pending';
                    item.className = `transaction-item ${tx.type} ${isPending ? 'pending' : ''}`;
                    const icons = { buy: 'fa-cart-plus', sell: 'fa-hand-holding-dollar', deposit: 'fa-arrow-down', withdrawal: 'fa-paper-plane', bonus: 'fa-gift' };
                    const amountDisplay = tx.type === 'buy' || tx.type === 'sell' ? `${Number(tx.amount).toFixed(2)} CDNC` : `$${Number(tx.amount).toFixed(2)}`;
                    const typeDisplay = isPending ? `${tx.type} (Pending)` : tx.type;
                    
                    item.innerHTML = `
                        <div class="icon"><i class="fas ${icons[tx.type] || 'fa-exchange-alt'}"></i></div>
                        <div class="details">
                            <div class="type">${tx.details?.reason || typeDisplay}</div>
                            <div class="date">${new Date(tx.timestamp).toLocaleString()}</div>
                        </div>
                        <div class="amount">${amountDisplay}</div>
                    `;
                    this.state.ui.transactionList.appendChild(item);
                });
            },

            // --- [4] EVENT LISTENERS & HANDLERS ---
            bindEventListeners() {
                document.getElementById('show-register-link').addEventListener('click', (e) => { e.preventDefault(); this.state.ui.loginPage.style.display = 'none'; this.state.ui.registerPage.style.display = 'block'; });
                document.getElementById('show-login-link').addEventListener('click', (e) => { e.preventDefault(); this.state.ui.registerPage.style.display = 'none'; this.state.ui.loginPage.style.display = 'block'; });
                this.state.ui.loginForm.addEventListener('submit', (e) => this.handleLogin(e));
                this.state.ui.registerForm.addEventListener('submit', (e) => this.handleRegister(e));
                document.getElementById('logout-btn').addEventListener('click', (e) => this.handleLogout(e));
                document.querySelectorAll('.toggle-password').forEach(toggle => {
                    toggle.addEventListener('click', (e) => {
                        const input = e.target.closest('.input-group').querySelector('input');
                        input.type = input.type === 'password' ? 'text' : 'password';
                        e.target.classList.toggle('fa-eye');
                        e.target.classList.toggle('fa-eye-slash');
                    });
                });
                document.querySelectorAll('.nav-btn').forEach(btn => btn.addEventListener('click', () => this.showPage(btn.dataset.page)));
                document.getElementById('recharge-btn-modal').addEventListener('click', () => this.showModal('recharge-modal'));
                document.getElementById('withdraw-btn-modal').addEventListener('click', () => this.showModal('withdrawal-modal'));
                document.querySelectorAll('.modal-close-btn').forEach(btn => btn.addEventListener('click', () => this.hideModal(btn.dataset.modalId)));
                document.getElementById('buy-btn').addEventListener('click', (e) => this.handleTrade('buy', e));
                document.getElementById('sell-btn').addEventListener('click', (e) => this.handleTrade('sell', e));
                this.state.ui.rechargeForm.addEventListener('submit', (e) => this.handleRecharge(e));
                this.state.ui.withdrawalForm.addEventListener('submit', (e) => this.handleWithdraw(e));
                document.querySelectorAll('#recharge-modal .option-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('#recharge-modal .option-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        const network = btn.dataset.network;
                        document.getElementById('recharge-trc20').style.display = network === 'trc20' ? 'block' : 'none';
                        document.getElementById('recharge-bep20').style.display = network === 'bep20' ? 'block' : 'none';
                    });
                });
                document.querySelectorAll('.copy-btn').forEach(btn => btn.addEventListener('click', () => this.copyToClipboard(btn.dataset.copyTarget)));
                document.getElementById('copy-invite-link-btn').addEventListener('click', (e) => {
                    const text = this.state.ui.inviteLinkDisplay.innerText;
                    this.copyToClipboard(text, true, e.currentTarget);
                });
                document.addEventListener('mousemove', (e) => this.handleCoinTilt(e));
                const refCode = new URLSearchParams(window.location.search).get('ref');
                if (refCode) { document.getElementById('register-ref-code').value = refCode; }
            },

            // --- [5] CORE LOGIC (AUTH, TRANSACTIONS, AI BOT) ---
            handleAuth() {
                this.auth.onAuthStateChanged(user => {
                    this.hidePreloader();
                    if (user) {
                        this.state.currentUser = user;
                        this.listenToUserData();
                        this.listenToMarketData();
                        this.state.ui.authContainer.classList.remove('active');
                        this.state.ui.appContainer.classList.add('active');
                        this.showPage('home-page');
                    } else {
                        this.state.currentUser = null;
                        this.state.userData = null;
                        this.stopAllListeners();
                        this.state.ui.authContainer.classList.add('active');
                        this.state.ui.appContainer.classList.remove('active');
                    }
                });
            },

            async handleRegister(e) {
                e.preventDefault();
                const btn = e.target.querySelector('button');
                this.setButtonLoading(btn, true);
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const refCode = document.getElementById('register-ref-code').value.trim();
                try {
                    const userCredential = await this.auth.createUserWithEmailAndPassword(email, password);
                    const user = userCredential.user;
                    const referralCode = 'CDNC' + Math.random().toString(36).substring(2, 8).toUpperCase();
                    const signupBonus = this.config.SIGNUP_BONUS_CDNC;
                    await this.db.ref('users/' + user.uid).set({
                        email: user.email, uid: user.uid, 
                        usd_balance: 0, 
                        cdnc_balance: signupBonus,
                        balance_on_hold: 0, // EDIT: Initialize hold balance
                        referralCode: referralCode, 
                        referredBy: refCode || null,
                    });
                    await this.logTransaction('bonus', signupBonus, { reason: 'Sign-up Bonus' });
                    this.showToast(`Registration successful! You received ${signupBonus} CDNC bonus.`, 'success');
                } catch (error) {
                    this.showToast(error.message, 'danger');
                } finally {
                    this.setButtonLoading(btn, false);
                }
            },

            async handleLogin(e) { /* No changes needed */ e.preventDefault(); const btn = e.target.querySelector('button'); this.setButtonLoading(btn, true); const email = document.getElementById('login-email').value; const password = document.getElementById('login-password').value; try { await this.auth.signInWithEmailAndPassword(email, password); } catch (error) { this.showToast(error.message, 'danger'); } finally { this.setButtonLoading(btn, false); } },
            async handleLogout(e) { /* No changes needed */ const btn = e.currentTarget; this.setButtonLoading(btn, true); try { await this.auth.signOut(); } catch (error) { this.showToast(error.message, 'danger'); } finally { this.setButtonLoading(btn, false); } },
            async handleTrade(type, e) { /* No changes needed */ const btn = e.currentTarget; const amountInput = document.getElementById('trade-amount'); const amount = parseFloat(amountInput.value); if (isNaN(amount) || amount <= 0) { return this.showToast('Please enter a valid positive amount.', 'danger'); } this.setButtonLoading(btn, true); const { usd_balance, cdnc_balance } = this.state.userData; const price = this.state.coinPrice; try { if (type === 'buy') { const cost = amount * price; if (usd_balance < cost) throw new Error('Insufficient USD balance.'); await this.db.ref('users/' + this.state.currentUser.uid).update({ usd_balance: usd_balance - cost, cdnc_balance: cdnc_balance + amount }); await this.logTransaction('buy', amount, { price }); this.showToast(`Successfully bought ${amount.toFixed(2)} CDNC!`, 'success'); } else if (type === 'sell') { if (cdnc_balance < amount) throw new Error('Insufficient CDNC balance.'); const gain = amount * price; await this.db.ref('users/' + this.state.currentUser.uid).update({ usd_balance: usd_balance + gain, cdnc_balance: cdnc_balance - amount }); await this.logTransaction('sell', amount, { price }); this.showToast(`Successfully sold ${amount.toFixed(2)} CDNC!`, 'success'); } amountInput.value = ''; } catch (err) { this.showToast(err.message, 'danger'); } finally { this.setButtonLoading(btn, false); } },

            async handleRecharge(e) {
                e.preventDefault();
                const btn = e.currentTarget.querySelector('button');
                const txId = document.getElementById('transaction-id').value.trim();
                const amount = parseFloat(document.getElementById('recharge-amount').value);
                if (!txId || isNaN(amount) || amount <= 0) return this.showToast('Please provide a valid amount and Transaction ID.', 'danger');
                this.setButtonLoading(btn, true);
                const network = document.querySelector('#recharge-modal .option-btn.active').dataset.network;
                
                try {
                    // EDIT: Create a request instead of updating balance
                    await this.db.ref('recharge_requests').push({
                        userId: this.state.currentUser.uid,
                        userEmail: this.state.currentUser.email,
                        amount,
                        network,
                        txId,
                        status: 'pending',
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });

                    await this.logTransaction('deposit', amount, { network, txId, status: 'pending' });
                    this.showToast(`Recharge request for $${amount.toFixed(2)} submitted for review!`, 'success');
                    this.state.ui.rechargeForm.reset();
                    this.hideModal('recharge-modal');
                } catch (err) {
                    this.showToast(`Request failed: ${err.message}`, 'danger');
                } finally {
                    this.setButtonLoading(btn, false);
                }
            },

            async handleWithdraw(e) {
                e.preventDefault();
                const btn = e.currentTarget.querySelector('button');
                const amount = parseFloat(document.getElementById('withdraw-amount').value);
                const address = document.getElementById('withdraw-address').value.trim();
                const network = document.getElementById('withdraw-network').value;
                if (isNaN(amount) || amount < this.config.MIN_WITHDRAWAL_USD || !address) return this.showToast('Please fill all fields with valid information.', 'danger');

                // EDIT: Check available balance, not total
                if (this.state.userData.usd_balance < amount) return this.showToast(`Insufficient available balance. You need $${amount.toFixed(2)}.`, 'danger');

                this.setButtonLoading(btn, true);
                const fee = amount * this.config.WITHDRAWAL_FEE_PERCENT;

                try {
                    // EDIT: Move funds to 'on hold' instead of deducting
                    await this.db.ref('users/' + this.state.currentUser.uid).update({ 
                        usd_balance: firebase.database.ServerValue.increment(-amount),
                        balance_on_hold: firebase.database.ServerValue.increment(amount)
                    });

                    await this.db.ref('withdrawal_requests').push({ 
                        userId: this.state.currentUser.uid,
                        userEmail: this.state.currentUser.email,
                        amount,
                        fee,
                        address,
                        network,
                        status: 'pending',
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });

                    await this.logTransaction('withdrawal', amount, { network, address, fee, status: 'pending' });
                    this.showToast('Withdrawal request submitted for review!', 'success');
                    this.state.ui.withdrawalForm.reset();
                    this.hideModal('withdrawal-modal');
                } catch (err) {
                    this.showToast(`Withdrawal failed: ${err.message}`, 'danger');
                    // Revert the hold if the request fails
                    await this.db.ref('users/' + this.state.currentUser.uid).update({ 
                        usd_balance: firebase.database.ServerValue.increment(amount),
                        balance_on_hold: firebase.database.ServerValue.increment(-amount)
                    });
                } finally {
                    this.setButtonLoading(btn, false);
                }
            },
            
            async triggerPriceUpdate(currentPrice) { /* No changes needed */ const { PRICE_INCREASE_MIN_PERCENT, PRICE_INCREASE_MAX_PERCENT } = this.config; const increasePercent = Math.random() * (PRICE_INCREASE_MAX_PERCENT - PRICE_INCREASE_MIN_PERCENT) + PRICE_INCREASE_MIN_PERCENT; const newPrice = currentPrice * (1 + increasePercent); await this.db.ref('market_data').set({ currentPrice: newPrice, lastUpdate: firebase.database.ServerValue.TIMESTAMP }); this.showToast(`AI Bot Updated Price! New Price: $${newPrice.toFixed(4)}`, 'success'); },
            async logTransaction(type, amount, details = {}) { if(!this.state.currentUser) return; const txData = { type, amount, details, timestamp: firebase.database.ServerValue.TIMESTAMP }; await this.db.ref(`transactions/${this.state.currentUser.uid}`).push(txData); },

            // --- [6] DATA LISTENERS ---
            listenToUserData() {
                if (!this.state.currentUser || this.state.userRef) return;
                this.state.userRef = this.db.ref('users/' + this.state.currentUser.uid);
                this.state.txRef = this.db.ref('transactions/' + this.state.currentUser.uid);
                this.state.userRef.on('value', (snapshot) => {
                    this.hidePreloader();
                    const oldUserData = { ...this.state.userData };
                    this.state.userData = snapshot.val();
                    if (this.state.userData) this.updateUI(oldUserData);
                    else this.auth.signOut();
                }, (error) => { console.error("Firebase user data listener error:", error); this.showToast("Could not sync user data.", "danger"); });
                this.state.txRef.on('value', (snapshot) => this.updateTransactionHistory(snapshot.val()));
            },

            listenToMarketData() { if (this.state.marketDataRef) return; this.state.marketDataRef = this.db.ref('market_data'); this.state.marketDataRef.on('value', async (snapshot) => { if (!snapshot.exists()) { await this.state.marketDataRef.set({ currentPrice: 1.25, lastUpdate: firebase.database.ServerValue.TIMESTAMP }); return; } const data = snapshot.val(); this.state.coinPrice = data.currentPrice; this.updateStaticPriceUI(); this.startCountdown(data.lastUpdate); const timeSinceUpdate = Date.now() - data.lastUpdate; const updateIntervalMs = this.config.PRICE_UPDATE_INTERVAL_HOURS * 60 * 60 * 1000; if (timeSinceUpdate > updateIntervalMs) { this.state.ui.aiBotStatus.textContent = "Updating Price..."; await this.triggerPriceUpdate(data.currentPrice); } else { this.state.ui.aiBotStatus.textContent = "Next update in:"; } }); },
            stopAllListeners() { if (this.state.userRef) this.state.userRef.off(); if (this.state.txRef) this.state.txRef.off(); if (this.state.marketDataRef) this.state.marketDataRef.off(); if (this.state.countdownInterval) clearInterval(this.state.countdownInterval); this.state.userRef = null; this.state.txRef = null; this.state.marketDataRef = null; this.state.countdownInterval = null; },

            // --- [7] HELPERS & UTILITIES ---
            startCountdown(lastUpdateTimestamp) { if (this.state.countdownInterval) clearInterval(this.state.countdownInterval); const updateIntervalMs = this.config.PRICE_UPDATE_INTERVAL_HOURS * 60 * 60 * 1000; const nextUpdateTime = lastUpdateTimestamp + updateIntervalMs; this.state.countdownInterval = setInterval(() => { const remainingMs = nextUpdateTime - Date.now(); if (remainingMs <= 0) { this.state.ui.aiBotCountdown.textContent = "00:00:00"; return; } const hours = Math.floor((remainingMs / (1000 * 60 * 60)) % 24).toString().padStart(2, '0'); const minutes = Math.floor((remainingMs / (1000 * 60)) % 60).toString().padStart(2, '0'); const seconds = Math.floor((remainingMs / 1000) % 60).toString().padStart(2, '0'); this.state.ui.aiBotCountdown.textContent = `${hours}:${minutes}:${seconds}`; }, 1000); },
            copyToClipboard(elementIdOrText, isText = false, btn = null) { const textToCopy = isText ? elementIdOrText : document.getElementById(elementIdOrText)?.innerText; if (!textToCopy) return; navigator.clipboard.writeText(textToCopy).then(() => { this.showToast('Copied to clipboard!', 'success'); if (btn) { const originalHTML = btn.innerHTML; btn.innerHTML = `<span class="btn-text"><i class="fas fa-check"></i>  Copied!</span>`; btn.disabled = true; setTimeout(() => { btn.innerHTML = originalHTML; btn.disabled = false; }, 2000); } }).catch(() => this.showToast('Failed to copy. Please copy manually.', 'danger')); },
            handleCoinTilt(e) { const coinContainer = document.getElementById('interactive-coin-container'); if (!coinContainer) return; const { clientX, clientY } = e; const { innerWidth, innerHeight } = window; const rotX = (clientY / innerHeight - 0.5) * -30; const rotY = (clientX / innerWidth - 0.5) * 30; coinContainer.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`; }
        };

        App.init();
    });
    </script>
</body>
</html>
